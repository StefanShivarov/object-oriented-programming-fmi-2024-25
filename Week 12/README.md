# –ö–æ–ª–µ–∫—Ü–∏–∏ –æ—Ç –æ–±–µ–∫—Ç–∏ –≤ –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–∞ –π–µ—Ä–∞—Ä—Ö–∏—è (—Ö–µ—Ç–µ—Ä–æ–≥–µ–Ω–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä) üóëÔ∏è. –ö–æ–ø–∏—Ä–∞–Ω–µ, —Ç—Ä–∏–µ–Ω–µ, —Ä–∞–∑–ø–æ–∑–Ω–∞–≤–∞–Ω–µ –∏ –ø—Ä–∏—Ö–≤–∞—â–∞–Ω–µ –Ω–∞ –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–∏ –æ–±–µ–∫—Ç–∏. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ. üíé –î–∏–∞–º–∞–Ω—Ç–µ–Ω –ø—Ä–æ–±–ª–µ–º üíé. –í–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ.

## –ö–æ–ª–µ–∫—Ü–∏–∏ –æ—Ç –æ–±–µ–∫—Ç–∏ –≤ –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–∞ –π–µ—Ä–∞—Ä—Ö–∏—è

### –•–µ—Ç–µ—Ä–æ–≥–µ–Ω–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–ú–æ–∂–µ–º –¥–∞ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞–º–µ –∫–æ–ª–µ–∫—Ü–∏—è –æ—Ç —Ä–∞–∑–ª–∏—á–Ω–∏ —Ç–∏–ø–æ–≤–µ (–Ω–æ —Å –æ–±—â –±–∞–∑–æ–≤ –∫–ª–∞—Å), —á—Ä–µ–∑ –º–∞—Å–∏–≤ –æ—Ç —É–∫–∞–∑–∞—Ç–µ–ª–∏. <br />
–£–∫–∞–∑–∞—Ç–µ–ª–∏—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –æ—Ç —Ç–∏–ø–∞ –Ω–∞ –±–∞–∑–æ–≤–∏—è –∫–ª–∞—Å. <br />

```c++
class Fruit {
public:
	virtual void printColor() const = 0;
	virtual ~Fruit() = default;
};

class Apple : public Fruit {
public:
	void printColor() const override {
		std::cout << "Red or green!\n ";
	}
};

class Orange : public Fruit {
public:
	void printColor() const override {
		std::cout << "Orange!\n";
	}
};

class Lemon : public Fruit {
public:
	size_t sourness;

	Lemon(size_t sourness) : sourness(sourness) {}

	void printColor() const override {
		std::cout << "Yellow!\n";
	}
};

class FruitStore {
private:
	Fruit** fruits;
	size_t capacity;
	size_t count;
public:
	FruitStore();
	FruitStore(const FruitStore&);
	FruitStore& operator=(const FruitStore&);
	~FruitStore();

	void addApple();
	void addOrange();
	void addLemon(size_t sourness);
private:
	void copyFrom(const FruitStore& other);
	void free();
};

void FruitStore::addApple() {
	fruits[count++] = new Apple();
}

void FruitStore::addOrange() {
	fruits[count++] = new Orange();
}

void FruitStore::addLemon(size_t sourness) {
	fruits[count++] = new Lemon(sourness);
}
```

## –¢—Ä–∏–µ–Ω–µ

–ü–æ–Ω–µ–∂–µ –∏–º–∞–º–µ –≤–∏—Ä—Ç—É–∞–ª–µ–Ω –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤ –±–∞–∑–æ–≤–∏—è –∫–ª–∞—Å, –Ω–µ —Å–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–≤–∞–º–µ –≤ –∫–æ–ª–µ–∫—Ü–∏—è—Ç–∞ –∫–∞–∫–≤–∏ —Å–∞ –æ–±–µ–∫—Ç–∏—Ç–µ, –∫–æ–∏—Ç–æ —Ç—Ä–∏–µ–º.

```c++
void FruitStore::free() {
	for(size_t i = 0; i < count; ++i) {
		delete fruits[i];
	}

	delete[] fruits;
}
```

## –ö–æ–ø–∏—Ä–∞–Ω–µ

–ò—Å–∫–∞–º–µ –¥–∞ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞–º–µ –∫–æ–ø–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–ª–µ–∫—Ü–∏—è—Ç–∞. <br />
–¢–æ–≤–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—Ç–∞–Ω–µ –±–µ–∑ –¥–∞ –Ω–∞—Ä—É—à–∞–≤–∞–º–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è—Ç–∞ - –∏—Å–∫–∞–º–µ –æ–±–µ–∫–∏—Ç–µ –¥–∞ —Å–µ –∫–æ–ø–∏—Ä–∞—Ç –±–µ–∑ –¥–∞ —Å–µ –Ω–∞–ª–∞–≥–∞ –¥–∞ –∑–∞–ø–∏—Ç–≤–∞–º–µ –∑–∞ —Ç–µ—Ö–Ω–∏—è —Ç–∏–ø. <br />
–ó–∞ —Ç–æ–≤–∞ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–º–µ –≤–∏—Ä—Ç—É–∞–ª–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è clone, –∫–æ—è—Ç–æ —â–µ –≤—Ä—ä—â–∞ –∫–æ–ø–∏–µ –Ω–∞ –æ–±–µ–∫—Ç–∞. –¢–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è —è —Ä–∞–∑–ø–∏—Å–≤–∞–º–µ –≤—ä–≤ –≤—Å–µ–∫–∏ –æ—Ç –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏—Ç–µ. <br />

```c++
class Fruit {
public:
    virtual void printColor() const = 0;
    virtual Fruit* clone() const = 0;

    virtual ~Fruit() = default
};

class Apple : public Fruit {
public:
    void printColor() const override {
	    std::cout << "Red or green!\n";
    }

    Fruit* clone() const override {
        return new Apple(*this);
    }
};

class Orange : public Fruit {
public:
    void printColor() const override {
	    std::cout << "Orange!\n";
    }

    Fruit* clone() const override {
	    return new Orange(*this);
    }
};

class Lemon : public Fruit {
public:
    size_t sourness;

    Lemon(size_t sourness) : sourness(sourness) {}

    void printColor() const override {
	    std::cout << "Yellow!\n";
    }

    Fruit* clone() const override {
	    return new Lemon(*this);
    }
};
```

–û—Ç —Ç—É–∫ –∫–æ–ø–∏—Ä–∞–Ω–µ—Ç–æ —Å—Ç–∞–≤–∞ —Ç—Ä–∏–≤–∏–∞–ª–Ω–æ:

```c++
void FruitStore::copyFrom(const FruitStore& other) {
	fruits = new Fruit*[other.capacity];

	for(size_t i = 0; i < other.count; ++i) {
		fruits[i] = other.fruits[u]->clone();
	}

	count = other.count;
	capacity = other.capacity;
}
```

## –†–∞–∑–ø–æ–∑–Ω–∞–≤–∞–Ω–µ –∏ –ø—Ä–∏—Ö–≤–∞—â–∞–Ω–µ

–í –¥–∞–¥–µ–Ω –º–æ–º–µ–Ω—Ç —â–µ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –¥–æ —Å–ª–µ–¥–Ω–∞—Ç–∞ —Å–∏—Ç—É–∞—Ü–∏—è –±–∏–ª–æ —Ç–æ —Å —Ñ–∏–≥—É—Ä–∏ –∏–ª–∏ –¥—Ä—É–≥–∞ –π–µ—Ä–∞—Ä—Ö–∏—è. –ù–µ–∫–∞ –∑–∞ –ø—Ä–∏–º–µ—Ä –∏–º–∞–º–µ —Å–ª–µ–¥–Ω–∞—Ç–∞ –π–µ—Ä–∞—Ä—Ö–∏—è:

–ë–∞–∑–æ–≤ –∫–ª–∞—Å: `Shape`

–ù–∞—Å–ª–µ–¥–Ω–∏—Ü–∏ –Ω–∞ `Shape`: `Circle`, `Rectangle`, `Triangle`

–ü—Ä–µ–¥—Å—Ç–∞–≤–µ—Ç–µ —Å–∏, —á–µ –∏–º–∞–º–µ –∫–æ–ª–µ–∫—Ü–∏—è –æ—Ç —Ñ–∏–≥—É—Ä–∏ (`Shape**`), –≤ –∫–æ—è—Ç–æ –≤—Å–µ–∫–∏ –ø–æ–∏–Ω—Ç—ä—Ä —Å–æ—á–∏ –∫—ä–º —Ä–∞–∑–ª–∏—á–µ–Ω –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –Ω–∞ —Ñ–∏–≥—É—Ä–∞.
**–•–µ—Ç–µ—Ä–æ–≥–µ–Ω–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**
- –ú–∞—Å–∏–≤ –æ—Ç —É–∫–∞–∑–∞—Ç–µ–ª–∏ –∫—ä–º –±–∞–∑–æ–≤ –∫–ª–∞—Å (–ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–∏ –æ–±–µ–∫—Ç–∏)
```c++
Shapes** data = new Shapes*[N];
```

![container](images/container.png)

–ò—Å–∫–∞–º–µ –¥–∞ –∏–∑–±–µ—Ä–µ–º –¥–≤–µ –ø—Ä–æ–∏–∑–≤–æ–ª–Ω–∏ —Ñ–∏–≥—É—Ä–∏ –æ—Ç –∫–æ–ª–µ–∫—Ü–∏—è—Ç–∞ –∏ –¥–∞ —Ä–∞–∑–±–µ—Ä–µ–º –¥–∞–ª–∏ —Å–µ –ø—Ä–µ—Å–∏—á–∞—Ç. –¢—É–∫ —Å–µ –ø–æ—è–≤—è–≤–∞ —Å–ª–µ–¥–Ω–∏—è—Ç –ø—Ä–æ–±–ª–µ–º - –Ω—è–º–∞ –µ–¥–Ω–∞–∫–≤–∞ —Ñ–æ—Ä–º—É–ª–∞, –ø–æ –∫–æ—è—Ç–æ –¥–∞ –æ–ø—Ä–µ–¥–µ–ª–∏–º –¥–∞–ª–∏ –µ–¥–Ω–∞ —Ñ–∏–≥—É—Ä–∞ —Å–µ –ø—Ä–µ—Å–∏—á–∞ —Å –¥—Ä—É–≥–∞. –ü—Ä–æ–≤–µ—Ä–∫–∞—Ç–∞ –¥–∞–ª–∏ —Å–µ –ø—Ä–µ—Å–∏—á–∞—Ç –∑–∞–≤–∏—Å–∏ –∏–∑—Ü—è–ª–æ –æ—Ç —Ç–æ–≤–∞ –∫–æ–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏ –Ω–∞ `Shape` —Å–∞ –¥–≤–µ—Ç–µ —Ñ–∏–≥—É—Ä–∏. –¢–æ–µ—Å—Ç –¥–∞–ª–∏ —Ç—Ä–∏—ä–≥—ä–ª–Ω–∏–∫ —Å–µ –ø—Ä–µ—Å–∏—á–∞ —Å—ä—Å –∫—Ä—ä–≥ –µ –µ–¥–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞, —Ç—Ä–∏—ä–≥—ä–ª–Ω–∏–∫ —Å —Ç—Ä–∏—ä–≥—ä–ª–Ω–∏–∫ –µ –¥—Ä—É–≥–∞ —Ñ–æ—Ä–º—É–ª–∞ –∏ —Ç.–Ω.

–í—Å–∏—á–∫–æ —Ç–æ–≤–∞ –≤–æ–¥–∏ –¥–æ —Å–∏—Ç—É–∞—Ü–∏—è—Ç–∞ –Ω–∏–µ –¥–∞ —Ä–∞–∑–±–µ—Ä–µ–º –∫–∞–∫–≤–∏ —Ñ–∏–≥—É—Ä–∏ —Å—Ç–æ—è—Ç –æ—Ç –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏, –∑–∞ –¥–∞ –∑–Ω–∞–µ–º –∫–æ—è —Ñ–æ—Ä–º—É–ª–∞ –¥–∞ –ø—Ä–∏–ª–æ–∂–∏–º.

**–í–∞—Ä–∏–∞–Ω—Ç 1: –î–∞ –Ω–∞—Ä—É—à–∏–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è—Ç–∞.**

–î–∏—Ä–µ–∫—Ç–Ω–æ –¥–∞ —Ä–∞–∑–±–µ—Ä–µ–º –∫—ä–º –∫–∞–∫–≤–æ —Å–æ—á–∏ –≤—Å–µ–∫–∏ `Shape*` —Å 3 if –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ `dynamic_cast`. –°–∞–º–∏ –º–æ–∂–µ–º –¥–∞ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á–µ —Ç–æ–≤–∞ –Ω–µ –µ –ø—Ä–∞–≤–∏–ª–Ω–æ—Ç–æ —Ä–µ—à–µ–Ω–∏–µ.

**–í–∞—Ä–∏–∞–Ω—Ç 2: Visitor design pattern.**

- –ù–∞–∫—Ä–∞—Ç–∫–æ –∫–∞–∫–≤–æ –µ design pattern - —à–∞–±–ª–æ–Ω (—Ç–æ–≤–∞ –Ω–µ –µ –ø–∞—Ä—á–µ –∫–æ–¥, –∫–æ–µ—Ç–æ copy-paste –∏ –¥–∞ —Ç—Ä—ä–≥–Ω–µ –º–∞–≥–∏—á–µ—Å–∫–∏), –ø–æ –∫–æ–π—Ç–æ —Å–µ —Ä–µ—à–∞–≤–∞—Ç —á–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ –≤ –æ–±–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞–Ω–∏—è —Å–≤—è—Ç. –í –Ω–∞—à–∏—è —Å–ª—É—á–∞–π –Ω–µ –∑–Ω–∞–µ–º –∫–∞–∫–≤–æ —Å–µ–¥–∏ –∑–∞–¥ –¥–≤–∞—Ç–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è, –Ω–æ –∏—Å–∫–∞–º–µ –¥–∞ –∏–∑–ø—ä–ª–Ω–∏–º –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç –∫–∞–∫–≤–æ —Å–µ–¥–∏ –æ—Ç–∑–∞–¥, –±–µ–∑ –¥–∞ –Ω–∞—Ä—É—à–∞–≤–∞–º–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è - Visitor design pattern.
- [Visitor explained - Refactoring Guru](https://refactoring.guru/design-patterns/visitor)

–í –Ω–∞—à–∞—Ç–∞ —Å–∏—Ç—É–∞—Ü–∏—è –∏—Å–∫–∞–º–µ –¥–∞ –ø–æ—Å—Ç–∏–≥–Ω–µ–º

```c++
Shape* s1 = generateRandomShape()
Shape* s2 = generateRandomShape();
std::cout << s1.intersectsWith(s2);
```

–†–µ—à–µ–Ω–∏–µ –µ –≤ –±–∞–∑–æ–≤–∏—è –∫–ª–∞—Å –¥–∞ —Å–µ –¥–æ–±–∞–≤—è—Ç —Å–ª–µ–¥–Ω–∏–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏:

```c++
virtual bool intersectsWith(const Shape* other) const = 0;

virtual bool intersectsWithTriangle(const Triangle* other) const = 0;
virtual bool intersectsWithRectangle(const Rectangle* other) const = 0;
virtual bool intersectsWithCircle(const Circle* other) const = 0;
```

–ü–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 3 —Å–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ç–µ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ —Ç–æ–≤–∞ –∫–∞–∫ –Ω–∞—à–∞—Ç–∞ —Ñ–∏–≥—É—Ä–∞(—Å—ä–æ—Ç–≤–µ—Ç–Ω–æ –Ω—è–∫–æ–π –æ—Ç –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏—Ç–µ) –¥–∞–ª–∏ —Å–µ –ø—Ä–µ—Å–∏—á–∞ —Å –≤—Å–∏—á–∫–∏ –æ—Å—Ç–∞–Ω–∞–ª–∏. –í—Å—è–∫–∞ —Ñ–∏–≥—É—Ä–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –¥–∞–¥–µ —Ç—è—Ö–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è.

–í –Ω–∞—à–∏—è—Ç —Å–ª—É—á–∞–π —Å s1 –∏ s2 –∏ –æ—Ç –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏ —Å–µ–¥—è—Ç –±–∞–∑–æ–≤–∏ –ø–æ–∏–Ω—Ç—ä—Ä–∏(–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏) –∏ –Ω–µ –∑–Ω–∞–µ–º –∫—ä–º –∫–∞–∫–≤–æ —Å–æ—á–∞—Ç, –∞ –∏—Å–∫–∞–º–µ –¥–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ intersectWithX —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—è—Ç–æ –¥–∞ –¥–∞–¥–µ —Ä–µ–∑—É–ª—Ç–∞—Ç (—Ç.–µ. –¥–∞ —Å–≤–∞–ª–∏–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏—Ç–µ –æ—Ç –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏ –∏ –¥–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ –∏ –æ—Ç –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏, –∑–∞ –¥–∞ –∑–Ω–∞–µ–º –∫–æ—è –µ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞.

–ù–∞ –ø—ä—Ä–≤–æ –º—è—Å—Ç–æ –Ω–∞ s1 –∏ s2 –∏–∑–≤–∏–∫–≤–∞–º–µ intersect, –ø–æ–Ω–µ–∂–µ —Ç—è –µ pure virtual –Ω–∏–µ —â–µ –∏–¥–µ–º –¥–æ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞** –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫. –î–æ—Å—Ç–∏–≥–∞–π–∫–∏ —Ç–∞–º, –Ω–∏–µ –≤–µ—á–µ —â–µ –∑–Ω–∞–µ–º –≤ –∫–æ–π –∫–ª–∞—Å —Å–µ –Ω–∞–º–∏—Ä–∞–º–µ (–±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ this pointer).

–ù–µ–∫–∞ –∑–∞ –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–∏–µ–º–µ–º, —á–µ `s1 –µ Circle` –∏ –ø—Ä–∏ `s1.intersectWith(s2)` –¥–æ—Å—Ç–∏–≥–∞–º–µ –¥–æ intersectWith –Ω–∞ Circle

```c++
bool Circle::intersectsWith(const Shape* other) const {
	return other->intersectsWithCircle(this);
}
```

–í —Ç–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∏–µ –∑–Ω–∞–µ–º, —á–µ this –µ `Circle* const`. –í–µ—á–µ –∑–Ω–∞–µ–º, —á–µ s1 –µ –∫—Ä—ä–≥, –Ω–æ –Ω—è–º–∞–º–µ –∏–¥–µ—è –∫–∞–∫–≤–æ –µ s2 (–≤ scope-a –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ —Ç–æ–≤–∞ –µ `const Shape* other` –ø–∞—Ä–∞–º–µ—Ç—ä—Ä–∞). –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ –∏–∑–≤–∏–∫–≤–∞–º–µ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –∑–∞ —Å–µ—á–µ–Ω–∏–µ —Å –∫—Ä—ä–≥ –Ω–∞ s2. –û—Ç —Ç–∞–º –æ—Ç–Ω–æ–≤–æ —â–µ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ `intersectsWithCircle` –Ω–∞ –Ω—è–∫–æ–π –æ—Ç –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏—Ç–µ, –∫–æ—è—Ç–æ —â–µ –¥—ä—Ä–∂–∏ –ª–æ–≥–∏–∫–∞—Ç–∞ –∑–∞ —Ç–æ–≤–∞ –¥–∞–ª–∏ —Å–µ –ø—Ä–µ—Å–∏—á–∞ –∫—Ä—ä–≥ —Å—ä—Å —Å—ä–æ—Ç–≤–µ—Ç–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –Ω–∞ Shape.
–¢.–µ. –í —Ç–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è —â–µ –∑–Ω–∞–µ–º –∏ s2 –∫–æ–π –æ—Ç —Ç—Ä–∏—Ç–µ –Ω–∞—Å–ª–µ–¥–Ω–∏ –µ.

–ò–∑–≤–æ–¥:
–ü—Ä–∏ –≤—Å—è–∫–æ –∏–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ `virtual` —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞ `Base*` –Ω–∏–µ —Å—Ç–∏–≥–∞–º–µ –¥–æ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞** –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫(—Ç.–µ. "—Ä–∞–∑–∫—Ä–∏–≤–∞–º–µ" —Ç–∞–∫–∞ –¥–∞ –∫–∞–∂–µ–º –∫–∞–∫–≤–æ —Å–µ–¥–∏ –æ—Ç–∑–∞–¥). –í –Ω–∞—à–∞—Ç–∞ –∑–∞–¥–∞—á–∞ –∏ –æ—Ç –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏ —Å–µ–¥–µ—à–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, —Å—ä–æ—Ç–≤–µ—Ç–Ω–æ –Ω–∏ —Ç—Ä—è–±–≤–∞—à–µ –∏–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ –¥–≤–µ virtual —Ñ—É–Ω–∫—Ü–∏–∏, –∑–∞ –¥–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –¥–æ –∫–æ–Ω—Ç—Ä–µ—Ç–∏–∫–∞—Ç–∞.

K–æ–¥—ä—Ç –∑–∞ ShapeCollection –º–æ–∂–µ –¥–∞ –≤–∏–¥–∏—Ç–µ [—Ç—É–∫](https://github.com/StefanShivarov/object-oriented-programming-fmi-2024-25/tree/main/Week%2012/ShapesCollection)

---

## –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ

–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–æ—Ç–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ –≤ C++ –ø–æ–∑–≤–æ–ª—è–≤–∞ –Ω–∞ –¥–∞–¥–µ–Ω –∫–ª–∞—Å –¥–∞ –Ω–∞—Å–ª–µ–¥–∏ –ø–æ–≤–µ—á–µ –æ—Ç –µ–¥–∏–Ω –±–∞–∑–æ–≤ –∫–ª–∞—Å.

```cpp
#include <iostream>
using namespace std;

class Person {
public:
    void identify() { cout << "I am a person.\n"; }
};

class Male {
public:
    void gender() { cout << "I am male.\n"; }
};

class Student : public Person, public Male {};

int main() {
    Student s;
    s.identify(); // –æ—Ç Person
    s.gender();   // –æ—Ç Male
}

```
### –ü—Ä–∏–º–µ—Ä 2:
![alt_text](https://i.ibb.co/zGscdZ9/Multiple-Inheritance.png)

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏ –∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ:
```c++
struct MyClass : SuperClass1, SuperClass2, SuperClass3, SuperClass4
{
	MyClass()
	{
		std::cout << "MyClass()" << std::endl;
	}
	~MyClass()
	{
		std::cout << "~MyClass()" << std::endl;
	}
};

int main()
{
	MyClass obj;
}
```

![alt_text](https://i.ibb.co/82xJ2JK/Constr-destr-Mult-Inh.png)

### –ö–æ–ø–∏—Ä–∞–Ω–µ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ:
```c++
MyClass(const MyClass& other) : SuperClass1(other), SuperClass2(other), SuperClass3(other), SuperClass4(other)
{
	copyFrom(other);
}

MyClass(const MyClass& other)
{
	if (this != &other)
	{
		SuperClass1::operator=(other);
		SuperClass2::operator=(other);
		SuperClass3::operator=(other);
		SuperClass4::operator=(other);

		free();
		copyFrom(other);
	}
}
```

---

## [–î–∏–∞–º–∞–Ω—Ç–µ–Ω –ø—Ä–æ–±–ª–µ–º](https://www.geeksforgeeks.org/diamond-problem-in-cpp/)

![Diamond-problem](images/diamond-problem-in-cpp.webp)

![Diamond-problem-Diagram](images/Diamond-problem.png)

```c++
//Indicate problem

#include <iostream>

class SuperClass {
public:
    SuperClass() {
        std::cout << "SuperClass default constructor is called\n";
    }
};

class A : public SuperClass {
public:
    A() {
        std::cout << "A default constructor is called\n";
    }
};

class B : public SuperClass {
public:
    B() {
        std::cout << "B default constructor is called\n";
    }
};

class C : public A, public B {
public:
    C() {
        std::cout << "C default constructor is called\n";
    }
};

int main() {
    C obj;
}
```

**Output:**

```
SuperClass default constructor is called
A default constructor is called
SuperClass default constructor is called //<------------
B default constructor is called
C default constructor is called
```

–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –Ω–∞ `SuperClass` –±–∏–≤–∞ –∏–∑–≤–∏–∫–∞–Ω 2 –ø—ä—Ç–∏, –∞ –∞–∫–æ –∏–º–∞—Ö–º–µ –∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä - —Ç–æ–π —Å—ä—â–æ —â–µ—à–µ –¥–∞ –±—ä–¥–µ –∏–∑–≤–∏–∫–∞–Ω 2 –ø—ä—Ç–∏.

–¢–æ–µ—Å—Ç, –æ–±–µ–∫—Ç—ä—Ç `obj` –∏–º–∞ 2 –∫–æ–ø–∏—è –Ω–∞ –≤—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏ –Ω–∞ –±–∞–∑–æ–≤–∏—è –∫–ª–∞—Å `SuperClass`, –∫–æ–µ—Ç–æ –ø—Ä–µ–¥–∏–∑–≤–∏–∫–≤–∞ –¥–≤—É—Å–º–∏—Å–ª–∏—è/–Ω–µ—è—Å–Ω–æ—Ç–∏–∏ (ambiguous behaviour).

---


![diamond_problem](images/diamond_problem.png)

- –í –∫–ª–∞—Å–∞ **D** —Å–º–µ –∑–∞–¥—ä–ª–∂–µ–Ω–∏ –¥–∞ –ø—Ä–µ–∑–∞–ø–∏—à–µ–º **f()**
- –í —Å–ª–µ–¥–Ω–∞—Ç–∞ —Å–∏—Ç—É–∞—Ü–∏—è –∏–º–∞–º–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–µ–Ω –ø—Ä–æ–±–ª–µ–º, –∑–∞—â–æ—Ç–æ —Å–µ –ø–æ–ª—É—á–∞–≤–∞ –¥—É–±–ª–∏—Ä–∞–Ω–µ –Ω–∞ –ø–∞–º–µ—Ç –ø—Ä–∏ —Å—ä–∑–¥–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ –∫–ª–∞—Å–∞ **A**. –†–µ—à–µ–Ω–∏–µ—Ç–æ –Ω–∞ —Ç–æ–∑–∏ –ø—Ä–æ–±–ª–µ–º –µ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –≤–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ

#### –ü—Ä–µ–¥—Å—Ç–∞–≤—è–Ω–µ –≤ –ø–∞–º–µ—Ç—Ç–∞

![d_problem_repr](images/d_problem_repr.png)

#### –ò–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏

```c++
A(), B(), A(), C(), D()
```

#### –ò–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏

```c++
~D(), ~C(), ~A(), ~B(), ~A()
```



## –í–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ

–†–µ—à–µ–Ω–∏–µ—Ç–æ –Ω–∞ –≥–æ—Ä–Ω–∏—è—Ç –ø—Ä–æ–±–ª–µ–º –µ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ. <br />
–ö–ª–∞—Å–æ–≤–µ—Ç–µ –ê –∏ –í —Ç—Ä—è–±–≤–∞ –¥–∞ –Ω–∞—Å–ª–µ–¥—è—Ç –≤–∏—Ä—Ç—É–∞–ª–Ω–æ SuperClass, –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ–º 2-—Ç–µ –∫–æ–ø–∏—è –Ω–∞ SuperClass.

–ö–æ–≥–∞—Ç–æ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ keyword: virtual –ø—Ä–∏ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ä—Ç –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–∞—Ä–æ–¥–∏—Ç–µ–ª—è —Å–µ –∏–∑–≤–∏–∫–≤–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ, –¥–æ—Ä–∏ –∞–∫–æ —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—Ç–µ –∫–ª–∞—Å–æ–≤–µ –∏–∑–≤–∏–∫–≤–∞—Ç –∏–∑—Ä–∏—á–Ω–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏. –¢–æ–µ—Å—Ç –≤—Å–µ–∫–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –Ω–∞ –∫–ª–∞—Å, –∫–æ–π—Ç–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞ –¥—Ä—É–≥ –∫–∞—Ç–æ virtual, —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–∑–±–µ—Ä–µ –∫–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å–µ –≤–∏–∫–∞ –Ω–∞ –ø—Ä–∞—Ä–æ–¥–∏—Ç–µ–ª—è(–≤–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥–µ–Ω–∏—è –∫–ª–∞—Å). –í —Å–ª—É—á–∞—è C, —Ç—Ä—è–±–≤–∞ –µ–∫—Å–ø–ª–∏—Ü–∏—Ç–Ω–æ –¥–∞ –∫–∞–∂–µ –∫–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–∞ SuperClass –¥–∞ —Å–µ –∏–∑–≤–∏–∫–∞. <br />

```c++
#include <iostream>

class SuperClass {
public:
    SuperClass() {
        std::cout << "SuperClass default constructor is called\n";
    }
};

class A : virtual public SuperClass {
public:
    A() {
        std::cout << "A default constructor is called\n";
    }
};

class B : virtual public SuperClass {
public:
    B() {
        std::cout << "B default constructor is called\n";
    }
};

class C : public A, public B {
public:
    C() {
        std::cout << "C default constructor is called\n";
    }
};

int main() {
    C obj;
}
```

**Output:**

```
SuperClass default constructor is called
A default constructor is called
B default constructor is called
C default constructor is called
```

### –ü—Ä–∏–º–µ—Ä 2

- –ó–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ–º –¥—É–±–ª–∏—Ä–∞–Ω–µ –Ω–∞ –ø–∞–º–µ—Ç, –º–æ–∂–µ–º –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –≤–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ. –ö–æ–≥–∞—Ç–æ –∫–ª–∞—Å –Ω–∞—Å–ª–µ–¥—è–≤–∞ –≤–∏—Ä—Ç—É–∞–ª–Ω–æ –¥—Ä—É–≥ –∫–ª–∞—Å, –≤—Å–∏—á–∫–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏ –Ω–∞–¥–æ–ª—É –ø–æ –π–µ—Ä–∞—Ä—Ö–∏—è—Ç–∞ —Å–∞ –¥–ª—ä–∂–Ω–∏ –¥–∞ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—Ä–∞—Ç
–ø—ä—Ä–≤–∏—è –∫–ª–∞—Å (–Ω–∞–π-–æ—Ç–≥–æ—Ä–µ –≤ –π–µ—Ä–∞—Ä—Ö–∏—è—Ç–∞). –ê–∫–æ —Ç–æ–≤–∞ –Ω–µ –≥–æ –Ω–∞–ø—Ä–∞–≤–∏–º, —Å–µ –∏–∑–≤–∏–∫–≤–∞ **default** constructor, –¥–æ—Ä–∏ –Ω—è–∫–æ–π –æ—Ç –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏—Ç–µ –ø–æ –π–µ—Ä–∞—Ä—Ö–∏—è—Ç–∞ –¥–∞ –∏–∑–≤–∏–∫–≤–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

```c++
class X : virtual Y { };
```

- –í—Å–µ–∫–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –Ω–∞ **X** (–ø—Ä—è–∫ –∏ –Ω–µ–ø—Ä—è–∫) –µ –æ—Ç–≥–æ–≤–æ—Ä–µ–Ω –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ **Y**
- –û—á–∞–∫–≤–∞–º–µ –æ–±–µ–∫—Ç—ä—Ç **Y** –¥–∞ —Å–µ —Å–ø–æ–¥–µ–ª—è –∏ –æ—Ç –¥—Ä—É–≥–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏

![diamond_solution](images/diamond_solution.png)

#### –ü—Ä–µ–¥—Å—Ç–∞–≤—è–Ω–µ –≤ –ø–∞–º–µ—Ç—Ç–∞

![d_solution_repr](images/d_solution_repr.png)

#### –ò–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏

- –°–ª–µ–¥ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ **virtual**, –ø—Ä–µ–¥–∏ –¥–∞ —Å–µ –∏–∑–≤–∏–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª, —Å–µ –ø—Ä–∞–≤–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Ç–æ–∑–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤–µ—á–µ –Ω–µ –µ –±–∏–ª –∏–∑–≤–∏–∫–∞–Ω

```c++
A(), B(), C(), D()
```

#### –ò–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏

- –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏—Ç–µ —Å–µ –∏–∑–≤–∏–∫–≤–∞—Ç –≤ –æ–±—Ä–∞—Ç–µ–Ω —Ä–µ–¥ –Ω–∞ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏—Ç–µ, –∫–∞—Ç–æ —Ç–∞–º —Å–µ –ø—Ä–∞–≤–∏ —Å—ä—â–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä—ä—Ç –≤–µ—á–µ –µ –∏–∑–≤–∏–∫–∞–Ω

```c++
~D(), ~C(), ~B(), ~A()
```




### üîç –ú–µ—Ö–∞–Ω–∏–∑—ä–º: –î–µ–ª—Ç–∞ –æ—Ç—Å—Ç–æ—è–Ω–∏–µ

–ö–æ–≥–∞—Ç–æ –¥–æ—Å—Ç—ä–ø–≤–∞–º–µ –≤–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥–µ–Ω –∫–ª–∞—Å, –∞–¥—Ä–µ—Å—ä—Ç –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –∏–∑—á–∏—Å–ª–µ–Ω —Å—ä—Å —Å—Ç–∞—Ç–∏—á–µ–Ω –æ—Ñ—Å–µ—Ç. –ö–æ–º–ø–∏–ª–∞—Ç–æ—Ä—ä—Ç –∏–∑–ø–æ–ª–∑–≤–∞ –≤–∏—Ä—Ç—É–∞–ª–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ (vtable), –∫–æ—è—Ç–æ —Å—ä–¥—ä—Ä–∂–∞ offset –∑–∞ –≤—Å—è–∫–∞ —Ñ-—è, –∑–∞ –¥–∞ –Ω–∞–º–µ—Ä–∏ —Ä–µ–∞–ª–Ω–∏—è –∞–¥—Ä–µ—Å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞.

–ü—Ä–∏–º–µ—Ä:

```cpp
class Person {
public:
    virtual void whoami() {
        cout << "Person\n";
    }
};

class Male : virtual public Person {};
class Female : virtual public Person {};
class Student : public Male, public Female {};

void call(Person* p) {
    p->whoami();
}

int main() {
    Student s;
    call(&s); // pointer to virtual Base
}
```

–ö–æ–º–ø–∏–ª–∞—Ç–æ—Ä—ä—Ç –≥–µ–Ω–µ—Ä–∏—Ä–∞ vtable —Å—ä—Å —Å–ø–µ—Ü–∏–∞–ª–µ–Ω –≤—Ö–æ–¥, —Å—ä–¥—ä—Ä–∂–∞—â –æ—Ñ—Å–µ—Ç –¥–æ Person.
–ö–æ–≥–∞—Ç–æ call(&s) —Å–µ –∏–∑–≤–∏–∫–∞, —Ä–µ–∞–ª–Ω–∏—è—Ç –∞–¥—Ä–µ—Å –¥–æ Person —Å–µ –∏–∑—á–∏—Å–ª—è–≤–∞ —á—Ä–µ–∑:

```cpp
real_ptr = (char*)&s + delta_to_virtual_base;
```

### Delta –æ—Ç—Å—Ç–æ—è–Ω–∏–µ

–ü–∞–º–µ—Ç—Ç–∞ –Ω–∞ `Student` (–≤–∏—Ä—Ç—É–∞–ª–Ω–æ –Ω–∞—Å–ª–µ–¥—è–≤–∞–Ω–µ):

```
[ Student ]
‚îú‚îÄ‚îÄ Male (vptr_Male)
‚îú‚îÄ‚îÄ Female (vptr_Female)
‚îî‚îÄ‚îÄ Person
```

vptr_Male –∏ vptr_Female —Å–æ—á–∞—Ç –∫—ä–º –≤–∏—Ä—Ç—É–∞–ª–Ω–∏ —Ç–∞–±–ª–∏—Ü–∏, –∫–æ–∏—Ç–æ —Å—ä–¥—ä—Ä–∂–∞—Ç:

- –§—É–Ω–∫—Ü–∏–∏
- –î–µ–ª—Ç–∞ –æ—Ç—Å—Ç–æ—è–Ω–∏—è

---

## –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –∑–∞–¥–∞—á–∞

```plaintext
					  A
		  virtual f(), g(), h(), k()
			  /                \
		  B                        C
	g() override()             f() override
			  \                /
					  D
				h() override
```

| Function    | Œî                |
| ----------- | ---------------- |
| A::k()      | 0                |
| B::g()      | -Œî(A)            |
| C::f()      | -Œî(A) + Œî(C)     |
| D::h()      | -Œî(A)            |


### –ó–∞ –ø–æ–≤–µ—á–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ç–µ–º–∞—Ç–∞, –º–æ–∂–µ –¥–∞ –ø–æ–≥–ª–µ–¥–Ω–µ—Ç–µ [—Ç–∞–∑–∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è](https://learn.fmi.uni-sofia.bg/pluginfile.php/138192/mod_resource/content/0/multinheritance.pdf).
